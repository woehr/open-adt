<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">{-|
Module:      Data.Deriving.Via.Internal
Copyright:   (C) 2015-2017 Ryan Scott
License:     BSD-style (see the file LICENSE)
Maintainer:  Ryan Scott
Portability: Template Haskell

On @template-haskell-2.12@ or later (i.e., GHC 8.2 or later), this module
exports functionality which emulates the @GeneralizedNewtypeDeriving@ and
@DerivingVia@ GHC extensions (the latter of which was introduced in GHC 8.6).

On older versions of @template-haskell@/GHC, this module does not export
anything.
-}</span><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Deriving.Via.Internal</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,12,0)
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=&lt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unless</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Deriving.Internal.html"><span class="hs-identifier">Data.Deriving.Internal</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.Haskell.TH</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.Haskell.TH.Datatype</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- Code generation</span><span>
</span><a name="line-32"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-comment">{- | Generates an instance for a type class at a newtype by emulating the
behavior of the @GeneralizedNewtypeDeriving@ extension. For example:

@
newtype Foo a = MkFoo a
$('deriveGND' [t| forall a. 'Eq' a =&gt; 'Eq' (Foo a) |])
@
-}</span><span>
</span><a name="line-42"></a><span class="hs-identifier">deriveGND</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-43"></a><a name="deriveGND"><a href="Data.Deriving.Via.Internal.html#deriveGND"><span class="hs-identifier">deriveGND</span></a></a><span> </span><a name="local-6989586621679061163"><a href="#local-6989586621679061163"><span class="hs-identifier">qty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-44"></a><span>  </span><a name="local-6989586621679061164"><a href="#local-6989586621679061164"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679061163"><span class="hs-identifier hs-var">qty</span></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679061165"><a href="#local-6989586621679061165"><span class="hs-identifier">instanceCxt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679061166"><a href="#local-6989586621679061166"><span class="hs-identifier">instanceTy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Via.Internal.html#decomposeType"><span class="hs-identifier hs-var">decomposeType</span></a><span> </span><a href="#local-6989586621679061164"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-46"></a><span>  </span><a name="local-6989586621679061167"><a href="#local-6989586621679061167"><span class="hs-identifier">instanceTy'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">resolveTypeSynonyms</span><span> </span><span class="hs-operator hs-var">&lt;=&lt;</span><span> </span><span class="hs-identifier hs-var">resolveInfixT</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679061166"><span class="hs-identifier hs-var">instanceTy</span></a><span>
</span><a name="line-47"></a><span>  </span><a name="local-6989586621679061168"><a href="#local-6989586621679061168"><span class="hs-identifier">decs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Deriving.Via.Internal.html#deriveViaDecs"><span class="hs-identifier hs-var">deriveViaDecs</span></a><span> </span><a href="#local-6989586621679061167"><span class="hs-identifier hs-var">instanceTy'</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-48"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">instanceD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679061165"><span class="hs-identifier hs-var">instanceCxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679061166"><span class="hs-identifier hs-var">instanceTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679061168"><span class="hs-identifier hs-var">decs</span></a><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-comment">{- | Generates an instance for a type class by emulating the behavior of the
@DerivingVia@ extension. For example:

@
newtype Foo a = MkFoo a
$('deriveVia' [t| forall a. 'Ord' a =&gt; 'Ord' (Foo a) ``Via`` Down a |])
@

As shown in the example above, the syntax is a tad strange. One must specify
the type by which to derive the instance using the 'Via' type. This
requirement is in place to ensure that the type variables are scoped
correctly across all the types being used (e.g., to make sure that the same
@a@ is used in @'Ord' a@, @'Ord' (Foo a)@, and @Down a@).
-}</span><span>
</span><a name="line-66"></a><span class="hs-identifier">deriveVia</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-67"></a><a name="deriveVia"><a href="Data.Deriving.Via.Internal.html#deriveVia"><span class="hs-identifier">deriveVia</span></a></a><span> </span><a name="local-6989586621679061169"><a href="#local-6989586621679061169"><span class="hs-identifier">qty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-68"></a><span>  </span><a name="local-6989586621679061170"><a href="#local-6989586621679061170"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679061169"><span class="hs-identifier hs-var">qty</span></a><span>
</span><a name="line-69"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679061171"><a href="#local-6989586621679061171"><span class="hs-identifier">instanceCxt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679061172"><a href="#local-6989586621679061172"><span class="hs-identifier">viaApp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Via.Internal.html#decomposeType"><span class="hs-identifier hs-var">decomposeType</span></a><span> </span><a href="#local-6989586621679061170"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-70"></a><span>  </span><a name="local-6989586621679061173"><a href="#local-6989586621679061173"><span class="hs-identifier">viaApp'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">resolveTypeSynonyms</span><span> </span><span class="hs-operator hs-var">&lt;=&lt;</span><span> </span><span class="hs-identifier hs-var">resolveInfixT</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679061172"><span class="hs-identifier hs-var">viaApp</span></a><span>
</span><a name="line-71"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679061177"><a href="#local-6989586621679061177"><span class="hs-identifier">instanceTy</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679061178"><a href="#local-6989586621679061178"><span class="hs-identifier">viaTy</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Data.Deriving.Internal.html#unapplyTy"><span class="hs-identifier hs-var">unapplyTy</span></a><span> </span><a href="#local-6989586621679061173"><span class="hs-identifier hs-var">viaApp'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-73"></a><span>         </span><span class="hs-special">[</span><a name="local-6989586621679061174"><a href="#local-6989586621679061174"><span class="hs-identifier">via</span></a></a><span class="hs-special">,</span><a name="local-6989586621679061175"><a href="#local-6989586621679061175"><span class="hs-identifier">instanceTy</span></a></a><span class="hs-special">,</span><a name="local-6989586621679061176"><a href="#local-6989586621679061176"><span class="hs-identifier">viaTy</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-74"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679061174"><span class="hs-identifier hs-var">via</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">ConT</span><span> </span><a href="Data.Deriving.Internal.html#viaTypeName"><span class="hs-identifier hs-var">viaTypeName</span></a><span>
</span><a name="line-75"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679061175"><span class="hs-identifier hs-var">instanceTy</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679061176"><span class="hs-identifier hs-var">viaTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unlines</span><span>
</span><a name="line-77"></a><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;Failure to meet &#8216;deriveVia&#8216; specification&quot;</span><span>
</span><a name="line-78"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;\tThe &#8216;Via&#8216; type must be used, e.g.&quot;</span><span>
</span><a name="line-79"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;\t[t| forall a. C (T a) `Via` V a |]&quot;</span><span>
</span><a name="line-80"></a><span>                </span><span class="hs-special">]</span><span>
</span><a name="line-81"></a><span>  </span><a name="local-6989586621679061179"><a href="#local-6989586621679061179"><span class="hs-identifier">decs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Deriving.Via.Internal.html#deriveViaDecs"><span class="hs-identifier hs-var">deriveViaDecs</span></a><span> </span><a href="#local-6989586621679061177"><span class="hs-identifier hs-var">instanceTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679061178"><span class="hs-identifier hs-var">viaTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">instanceD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679061171"><span class="hs-identifier hs-var">instanceCxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679061177"><span class="hs-identifier hs-var">instanceTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679061179"><span class="hs-identifier hs-var">decs</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-identifier">deriveViaDecs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span>       </span><span class="hs-comment">-- ^ The instance head (e.g., @Eq (Foo a)@)</span><span>
</span><a name="line-87"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-comment">-- ^ If using 'deriveGND', this is 'Nothing.</span><span>
</span><a name="line-88"></a><span>                            </span><span class="hs-comment">--   If using 'deriveVia', this is 'Just' the @via@ type.</span><span>
</span><a name="line-89"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-90"></a><a name="deriveViaDecs"><a href="Data.Deriving.Via.Internal.html#deriveViaDecs"><span class="hs-identifier">deriveViaDecs</span></a></a><span> </span><a name="local-6989586621679061180"><a href="#local-6989586621679061180"><span class="hs-identifier">instanceTy</span></a></a><span> </span><a name="local-6989586621679061181"><a href="#local-6989586621679061181"><span class="hs-identifier">mbViaTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-91"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679061182"><a href="#local-6989586621679061182"><span class="hs-identifier">clsTy</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679061183"><a href="#local-6989586621679061183"><span class="hs-identifier">clsArgs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Internal.html#unapplyTy"><span class="hs-identifier hs-var">unapplyTy</span></a><span> </span><a href="#local-6989586621679061180"><span class="hs-identifier hs-var">instanceTy</span></a><span>
</span><a name="line-92"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679061182"><span class="hs-identifier hs-var">clsTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-identifier hs-var">ConT</span><span> </span><a name="local-6989586621679061184"><a href="#local-6989586621679061184"><span class="hs-identifier">clsName</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-94"></a><span>      </span><a name="local-6989586621679061185"><a href="#local-6989586621679061185"><span class="hs-identifier">clsInfo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reify</span><span> </span><a href="#local-6989586621679061184"><span class="hs-identifier hs-var">clsName</span></a><span>
</span><a name="line-95"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679061185"><span class="hs-identifier hs-var">clsInfo</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-96"></a><span>        </span><span class="hs-identifier hs-var">ClassI</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679061186"><a href="#local-6989586621679061186"><span class="hs-identifier">clsTvbs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679061187"><a href="#local-6989586621679061187"><span class="hs-identifier">clsDecs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-97"></a><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="Data.Deriving.Internal.html#unsnoc"><span class="hs-identifier hs-var">unsnoc</span></a><span> </span><a href="#local-6989586621679061183"><span class="hs-identifier hs-var">clsArgs</span></a><span class="hs-special">,</span><span> </span><a href="Data.Deriving.Internal.html#unsnoc"><span class="hs-identifier hs-var">unsnoc</span></a><span> </span><a href="#local-6989586621679061186"><span class="hs-identifier hs-var">clsTvbs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-98"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679061188"><a href="#local-6989586621679061188"><span class="hs-identifier">dataApp</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679061189"><a href="#local-6989586621679061189"><span class="hs-identifier">clsLastTvb</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-99"></a><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679061190"><a href="#local-6989586621679061190"><span class="hs-identifier">dataTy</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679061191"><a href="#local-6989586621679061191"><span class="hs-identifier">dataArgs</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Internal.html#unapplyTy"><span class="hs-identifier hs-var">unapplyTy</span></a><span> </span><a href="#local-6989586621679061188"><span class="hs-identifier hs-var">dataApp</span></a><span>
</span><a name="line-100"></a><span>                  </span><a name="local-6989586621679061192"><a href="#local-6989586621679061192"><span class="hs-identifier">clsLastTvbKind</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Internal.html#tvbKind"><span class="hs-identifier hs-var">tvbKind</span></a><span> </span><a href="#local-6989586621679061189"><span class="hs-identifier hs-var">clsLastTvb</span></a><span>
</span><a name="line-101"></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679061193"><a href="#local-6989586621679061193"><span class="hs-identifier">kindList</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Internal.html#uncurryTy"><span class="hs-identifier hs-var">uncurryTy</span></a><span> </span><a href="#local-6989586621679061192"><span class="hs-identifier hs-var">clsLastTvbKind</span></a><span>
</span><a name="line-102"></a><span>                  </span><a name="local-6989586621679061194"><a href="#local-6989586621679061194"><span class="hs-identifier">numArgsToEtaReduce</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679061193"><span class="hs-identifier hs-var">kindList</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-103"></a><span>              </span><a name="local-6989586621679061205"><a href="#local-6989586621679061205"><span class="hs-identifier">repTy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-104"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679061181"><span class="hs-identifier hs-var">mbViaTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-105"></a><span>                  </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679061195"><a href="#local-6989586621679061195"><span class="hs-identifier">viaTy</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679061195"><span class="hs-identifier hs-var">viaTy</span></a><span>
</span><a name="line-106"></a><span>                  </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-107"></a><span>                    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679061190"><span class="hs-identifier hs-var">dataTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-108"></a><span>                      </span><span class="hs-identifier hs-var">ConT</span><span> </span><a name="local-6989586621679061196"><a href="#local-6989586621679061196"><span class="hs-identifier">dataName</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-109"></a><span>                        </span><span class="hs-identifier hs-var">DatatypeInfo</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">datatypeVars</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679061197"><a href="#local-6989586621679061197"><span class="hs-identifier">dataVars</span></a></a><span>
</span><a name="line-110"></a><span>                                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">datatypeVariant</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679061198"><a href="#local-6989586621679061198"><span class="hs-identifier">dv</span></a></a><span>
</span><a name="line-111"></a><span>                                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">datatypeCons</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679061199"><a href="#local-6989586621679061199"><span class="hs-identifier">cons</span></a></a><span>
</span><a name="line-112"></a><span>                                     </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reifyDatatype</span><span> </span><a href="#local-6989586621679061196"><span class="hs-identifier hs-var">dataName</span></a><span>
</span><a name="line-113"></a><span>                        </span><span class="hs-keyword">case</span><span> </span><a href="Data.Deriving.Via.Internal.html#newtypeRepType"><span class="hs-identifier hs-var">newtypeRepType</span></a><span> </span><a href="#local-6989586621679061198"><span class="hs-identifier hs-var">dv</span></a><span> </span><a href="#local-6989586621679061199"><span class="hs-identifier hs-var">cons</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-114"></a><span>                          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679061200"><a href="#local-6989586621679061200"><span class="hs-identifier">newtypeRepTy</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-115"></a><span>                            </span><span class="hs-keyword">case</span><span> </span><a href="Data.Deriving.Via.Internal.html#etaReduce"><span class="hs-identifier hs-var">etaReduce</span></a><span> </span><a href="#local-6989586621679061194"><span class="hs-identifier hs-var">numArgsToEtaReduce</span></a><span> </span><a href="#local-6989586621679061200"><span class="hs-identifier hs-var">newtypeRepTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-116"></a><span>                              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679061201"><a href="#local-6989586621679061201"><span class="hs-identifier">etaRepTy</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-117"></a><span>                                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679061202"><a href="#local-6989586621679061202"><span class="hs-identifier">repTySubst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-118"></a><span>                                      </span><span class="hs-identifier hs-var">M.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-119"></a><span>                                      </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679061203"><a href="#local-6989586621679061203"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679061204"><a href="#local-6989586621679061204"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Deriving.Internal.html#varTToName"><span class="hs-identifier hs-var">varTToName</span></a><span> </span><a href="#local-6989586621679061203"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679061204"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>                                              </span><a href="#local-6989586621679061197"><span class="hs-identifier hs-var">dataVars</span></a><span> </span><a href="#local-6989586621679061191"><span class="hs-identifier hs-var">dataArgs</span></a><span>
</span><a name="line-121"></a><span>                                </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">applySubstitution</span><span> </span><a href="#local-6989586621679061202"><span class="hs-identifier hs-var">repTySubst</span></a><span> </span><a href="#local-6989586621679061201"><span class="hs-identifier hs-var">etaRepTy</span></a><span>
</span><a name="line-122"></a><span>                              </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Deriving.Internal.html#etaReductionError"><span class="hs-identifier hs-var">etaReductionError</span></a><span> </span><a href="#local-6989586621679061180"><span class="hs-identifier hs-var">instanceTy</span></a><span>
</span><a name="line-123"></a><span>                          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Not a newtype: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span> </span><a href="#local-6989586621679061196"><span class="hs-identifier hs-var">dataName</span></a><span>
</span><a name="line-124"></a><span>                      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Not a data type: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">pprint</span><span> </span><a href="#local-6989586621679061190"><span class="hs-identifier hs-var">dataTy</span></a><span>
</span><a name="line-125"></a><span>              </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><span class="hs-special">(</span><a href="Data.Deriving.Via.Internal.html#deriveViaDecs%27"><span class="hs-identifier hs-var">deriveViaDecs'</span></a><span> </span><a href="#local-6989586621679061184"><span class="hs-identifier hs-var">clsName</span></a><span> </span><a href="#local-6989586621679061186"><span class="hs-identifier hs-var">clsTvbs</span></a><span> </span><a href="#local-6989586621679061183"><span class="hs-identifier hs-var">clsArgs</span></a><span> </span><a href="#local-6989586621679061205"><span class="hs-identifier hs-var">repTy</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679061187"><span class="hs-identifier hs-var">clsDecs</span></a><span>
</span><a name="line-126"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Cannot derive instance for nullary class &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">pprint</span><span> </span><a href="#local-6989586621679061182"><span class="hs-identifier hs-var">clsTy</span></a><span>
</span><a name="line-127"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Not a type class: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">pprint</span><span> </span><a href="#local-6989586621679061182"><span class="hs-identifier hs-var">clsTy</span></a><span>
</span><a name="line-128"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Malformed instance: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">pprint</span><span> </span><a href="#local-6989586621679061180"><span class="hs-identifier hs-var">instanceTy</span></a><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-identifier">deriveViaDecs'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><a name="deriveViaDecs%27"><a href="Data.Deriving.Via.Internal.html#deriveViaDecs%27"><span class="hs-identifier">deriveViaDecs'</span></a></a><span> </span><a name="local-6989586621679061206"><a href="#local-6989586621679061206"><span class="hs-identifier">clsName</span></a></a><span> </span><a name="local-6989586621679061207"><a href="#local-6989586621679061207"><span class="hs-identifier">clsTvbs</span></a></a><span> </span><a name="local-6989586621679061208"><a href="#local-6989586621679061208"><span class="hs-identifier">clsArgs</span></a></a><span> </span><a name="local-6989586621679061209"><a href="#local-6989586621679061209"><span class="hs-identifier">repTy</span></a></a><span> </span><a name="local-6989586621679061210"><a href="#local-6989586621679061210"><span class="hs-identifier">dec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-132"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679061230"><a href="#local-6989586621679061230"><span class="hs-identifier">numExpectedArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679061207"><span class="hs-identifier hs-var">clsTvbs</span></a><span>
</span><a name="line-133"></a><span>        </span><a name="local-6989586621679061231"><a href="#local-6989586621679061231"><span class="hs-identifier">numActualArgs</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679061208"><span class="hs-identifier hs-var">clsArgs</span></a><span>
</span><a name="line-134"></a><span>    </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679061230"><span class="hs-identifier hs-var">numExpectedArgs</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679061231"><span class="hs-identifier hs-var">numActualArgs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-135"></a><span>      </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Mismatched number of class arguments&quot;</span><span>
</span><a name="line-136"></a><span>          </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n\tThe class &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span> </span><a href="#local-6989586621679061206"><span class="hs-identifier hs-var">clsName</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; expects &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679061230"><span class="hs-identifier hs-var">numExpectedArgs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; argument(s),&quot;</span><span>
</span><a name="line-137"></a><span>          </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n\tbut was provided &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679061231"><span class="hs-identifier hs-var">numActualArgs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; argument(s).&quot;</span><span>
</span><a name="line-138"></a><span>    </span><a href="#local-6989586621679061211"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679061210"><span class="hs-identifier hs-var">dec</span></a><span>
</span><a name="line-139"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-140"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>    </span><a name="local-6989586621679061211"><a href="#local-6989586621679061211"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpenTypeFamilyD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeFamilyHead</span><span> </span><a name="local-6989586621679061212"><a href="#local-6989586621679061212"><span class="hs-identifier">tfName</span></a></a><span> </span><a name="local-6989586621679061213"><a href="#local-6989586621679061213"><span class="hs-identifier">tfTvbs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-143"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679061214"><a href="#local-6989586621679061214"><span class="hs-identifier">lhsSubst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier hs-var">zipTvbSubst</span></a><span> </span><a href="#local-6989586621679061207"><span class="hs-identifier hs-var">clsTvbs</span></a><span> </span><a href="#local-6989586621679061208"><span class="hs-identifier hs-var">clsArgs</span></a><span>
</span><a name="line-144"></a><span>          </span><a name="local-6989586621679061215"><a href="#local-6989586621679061215"><span class="hs-identifier">rhsSubst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier hs-var">zipTvbSubst</span></a><span> </span><a href="#local-6989586621679061207"><span class="hs-identifier hs-var">clsTvbs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier hs-var">changeLast</span></a><span> </span><a href="#local-6989586621679061208"><span class="hs-identifier hs-var">clsArgs</span></a><span> </span><a href="#local-6989586621679061209"><span class="hs-identifier hs-var">repTy</span></a><span>
</span><a name="line-145"></a><span>          </span><a name="local-6989586621679061216"><a href="#local-6989586621679061216"><span class="hs-identifier">tfTvbTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Data.Deriving.Internal.html#tvbToType"><span class="hs-identifier hs-var">tvbToType</span></a><span> </span><a href="#local-6989586621679061213"><span class="hs-identifier hs-var">tfTvbs</span></a><span>
</span><a name="line-146"></a><span>          </span><a name="local-6989586621679061217"><a href="#local-6989586621679061217"><span class="hs-identifier">tfLHSTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">applySubstitution</span><span> </span><a href="#local-6989586621679061214"><span class="hs-identifier hs-var">lhsSubst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679061216"><span class="hs-identifier hs-var">tfTvbTys</span></a><span>
</span><a name="line-147"></a><span>          </span><a name="local-6989586621679061218"><a href="#local-6989586621679061218"><span class="hs-identifier">tfRHSTys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">applySubstitution</span><span> </span><a href="#local-6989586621679061215"><span class="hs-identifier hs-var">rhsSubst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679061216"><span class="hs-identifier hs-var">tfTvbTys</span></a><span>
</span><a name="line-148"></a><span>          </span><a name="local-6989586621679061219"><a href="#local-6989586621679061219"><span class="hs-identifier">tfRHSTy</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Internal.html#applyTy"><span class="hs-identifier hs-var">applyTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><a href="#local-6989586621679061212"><span class="hs-identifier hs-var">tfName</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679061218"><span class="hs-identifier hs-var">tfRHSTys</span></a><span>
</span><a name="line-149"></a><span>          </span><a name="local-6989586621679061220"><a href="#local-6989586621679061220"><span class="hs-identifier">tfInst</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TySynInstD</span><span> </span><a href="#local-6989586621679061212"><span class="hs-identifier hs-var">tfName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TySynEqn</span><span> </span><a href="#local-6989586621679061217"><span class="hs-identifier hs-var">tfLHSTys</span></a><span> </span><a href="#local-6989586621679061219"><span class="hs-identifier hs-var">tfRHSTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679061220"><span class="hs-identifier hs-var">tfInst</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigD</span><span> </span><a name="local-6989586621679061221"><a href="#local-6989586621679061221"><span class="hs-identifier">methName</span></a></a><span> </span><a name="local-6989586621679061222"><a href="#local-6989586621679061222"><span class="hs-identifier">methTy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-153"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679061223"><a href="#local-6989586621679061223"><span class="hs-identifier">fromTy</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679061224"><a href="#local-6989586621679061224"><span class="hs-identifier">toTy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Via.Internal.html#mkCoerceClassMethEqn"><span class="hs-identifier hs-var">mkCoerceClassMethEqn</span></a><span> </span><a href="#local-6989586621679061207"><span class="hs-identifier hs-var">clsTvbs</span></a><span> </span><a href="#local-6989586621679061208"><span class="hs-identifier hs-var">clsArgs</span></a><span> </span><a href="#local-6989586621679061209"><span class="hs-identifier hs-var">repTy</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-154"></a><span>                           </span><a href="Data.Deriving.Via.Internal.html#stripOuterForallT"><span class="hs-identifier hs-var">stripOuterForallT</span></a><span> </span><a href="#local-6989586621679061222"><span class="hs-identifier hs-var">methTy</span></a><span>
</span><a name="line-155"></a><span>          </span><a name="local-6989586621679061225"><a href="#local-6989586621679061225"><span class="hs-identifier">fromTau</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Via.Internal.html#stripOuterForallT"><span class="hs-identifier hs-var">stripOuterForallT</span></a><span> </span><a href="#local-6989586621679061223"><span class="hs-identifier hs-var">fromTy</span></a><span>
</span><a name="line-156"></a><span>          </span><a name="local-6989586621679061226"><a href="#local-6989586621679061226"><span class="hs-identifier">toTau</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Via.Internal.html#stripOuterForallT"><span class="hs-identifier hs-var">stripOuterForallT</span></a><span> </span><a href="#local-6989586621679061224"><span class="hs-identifier hs-var">toTy</span></a><span>
</span><a name="line-157"></a><span>          </span><a name="local-6989586621679061227"><a href="#local-6989586621679061227"><span class="hs-identifier">rhsExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">VarE</span><span> </span><a href="Data.Deriving.Internal.html#coerceValName"><span class="hs-identifier hs-var">coerceValName</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppTypeE</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679061225"><span class="hs-identifier hs-var">fromTau</span></a><span>
</span><a name="line-158"></a><span>                                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppTypeE</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679061226"><span class="hs-identifier hs-var">toTau</span></a><span>
</span><a name="line-159"></a><span>                                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span>     </span><span class="hs-identifier hs-var">VarE</span><span> </span><a href="#local-6989586621679061221"><span class="hs-identifier hs-var">methName</span></a><span>
</span><a name="line-160"></a><span>          </span><a name="local-6989586621679061228"><a href="#local-6989586621679061228"><span class="hs-identifier">sig</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SigD</span><span> </span><a href="#local-6989586621679061221"><span class="hs-identifier hs-var">methName</span></a><span> </span><a href="#local-6989586621679061224"><span class="hs-identifier hs-var">toTy</span></a><span>
</span><a name="line-161"></a><span>          </span><a name="local-6989586621679061229"><a href="#local-6989586621679061229"><span class="hs-identifier">meth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ValD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarP</span><span> </span><a href="#local-6989586621679061221"><span class="hs-identifier hs-var">methName</span></a><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>                      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalB</span><span> </span><a href="#local-6989586621679061227"><span class="hs-identifier hs-var">rhsExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span>                      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-164"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679061228"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679061229"><span class="hs-identifier hs-var">meth</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-identifier">mkCoerceClassMethEqn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span>
</span><a name="line-169"></a><a name="mkCoerceClassMethEqn"><a href="Data.Deriving.Via.Internal.html#mkCoerceClassMethEqn"><span class="hs-identifier">mkCoerceClassMethEqn</span></a></a><span> </span><a name="local-6989586621679061232"><a href="#local-6989586621679061232"><span class="hs-identifier">clsTvbs</span></a></a><span> </span><a name="local-6989586621679061233"><a href="#local-6989586621679061233"><span class="hs-identifier">clsArgs</span></a></a><span> </span><a name="local-6989586621679061234"><a href="#local-6989586621679061234"><span class="hs-identifier">repTy</span></a></a><span> </span><a name="local-6989586621679061235"><a href="#local-6989586621679061235"><span class="hs-identifier">methTy</span></a></a><span>
</span><a name="line-170"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">applySubstitution</span><span> </span><a href="#local-6989586621679061237"><span class="hs-identifier hs-var">rhsSubst</span></a><span> </span><a href="#local-6989586621679061235"><span class="hs-identifier hs-var">methTy</span></a><span>
</span><a name="line-171"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">applySubstitution</span><span> </span><a href="#local-6989586621679061236"><span class="hs-identifier hs-var">lhsSubst</span></a><span> </span><a href="#local-6989586621679061235"><span class="hs-identifier hs-var">methTy</span></a><span>
</span><a name="line-172"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-174"></a><span>    </span><a name="local-6989586621679061236"><a href="#local-6989586621679061236"><span class="hs-identifier">lhsSubst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier hs-var">zipTvbSubst</span></a><span> </span><a href="#local-6989586621679061232"><span class="hs-identifier hs-var">clsTvbs</span></a><span> </span><a href="#local-6989586621679061233"><span class="hs-identifier hs-var">clsArgs</span></a><span>
</span><a name="line-175"></a><span>    </span><a name="local-6989586621679061237"><a href="#local-6989586621679061237"><span class="hs-identifier">rhsSubst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier hs-var">zipTvbSubst</span></a><span> </span><a href="#local-6989586621679061232"><span class="hs-identifier hs-var">clsTvbs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier hs-var">changeLast</span></a><span> </span><a href="#local-6989586621679061233"><span class="hs-identifier hs-var">clsArgs</span></a><span> </span><a href="#local-6989586621679061234"><span class="hs-identifier hs-var">repTy</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-identifier">zipTvbSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVarBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-178"></a><a name="zipTvbSubst"><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier">zipTvbSubst</span></a></a><span> </span><a name="local-6989586621679061238"><a href="#local-6989586621679061238"><span class="hs-identifier">tvbs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M.fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679061239"><a href="#local-6989586621679061239"><span class="hs-identifier">tvb</span></a></a><span> </span><a name="local-6989586621679061240"><a href="#local-6989586621679061240"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tvName</span><span> </span><a href="#local-6989586621679061239"><span class="hs-identifier hs-var">tvb</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679061240"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679061238"><span class="hs-identifier hs-var">tvbs</span></a><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-comment">-- | Replace the last element of a list with another element.</span><span>
</span><a name="line-181"></a><span class="hs-identifier">changeLast</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679061162"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679061162"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679061162"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-182"></a><a name="changeLast"><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier">changeLast</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;changeLast&quot;</span><span>
</span><a name="line-183"></a><span class="hs-identifier">changeLast</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span>    </span><a name="local-6989586621679061241"><a href="#local-6989586621679061241"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679061241"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-184"></a><span class="hs-identifier">changeLast</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679061242"><a href="#local-6989586621679061242"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679061243"><a href="#local-6989586621679061243"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679061244"><a href="#local-6989586621679061244"><span class="hs-identifier">x'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679061242"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier hs-var">changeLast</span></a><span> </span><a href="#local-6989586621679061243"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621679061244"><span class="hs-identifier hs-var">x'</span></a><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-identifier">stripOuterForallT</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-187"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 807
</span><span class="hs-comment">-- Before GHC 8.7, TH-reified classes would put a redundant forall/class</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- context in front of each method's type signature, so we have to strip them</span><span>
</span><a name="line-190"></a><span class="hs-comment">-- off here.</span><span>
</span><a name="line-191"></a><a name="stripOuterForallT"><a href="Data.Deriving.Via.Internal.html#stripOuterForallT"><span class="hs-identifier">stripOuterForallT</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallT</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679061245"><a href="#local-6989586621679061245"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679061245"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-192"></a><span class="hs-cpp">#endif
</span><span class="hs-identifier">stripOuterForallT</span><span> </span><a name="local-6989586621679061246"><a href="#local-6989586621679061246"><span class="hs-identifier">ty</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679061246"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-identifier">decomposeType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Cxt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><a name="decomposeType"><a href="Data.Deriving.Via.Internal.html#decomposeType"><span class="hs-identifier">decomposeType</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallT</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679061247"><a href="#local-6989586621679061247"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621679061248"><a href="#local-6989586621679061248"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679061247"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679061248"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span class="hs-identifier">decomposeType</span><span> </span><a name="local-6989586621679061249"><a href="#local-6989586621679061249"><span class="hs-identifier">ty</span></a></a><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>   </span><a href="#local-6989586621679061249"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-identifier">newtypeRepType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DatatypeVariant</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ConstructorInfo</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-200"></a><a name="newtypeRepType"><a href="Data.Deriving.Via.Internal.html#newtypeRepType"><span class="hs-identifier">newtypeRepType</span></a></a><span> </span><a name="local-6989586621679061250"><a href="#local-6989586621679061250"><span class="hs-identifier">dv</span></a></a><span> </span><a name="local-6989586621679061251"><a href="#local-6989586621679061251"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-201"></a><span>    </span><a href="#local-6989586621679061252"><span class="hs-identifier hs-var">checkIfNewtype</span></a><span>
</span><a name="line-202"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679061251"><span class="hs-identifier hs-var">cons</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-203"></a><span>      </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ConstructorInfo</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">constructorVars</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-204"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">constructorContext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-205"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">constructorFields</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679061253"><a href="#local-6989586621679061253"><span class="hs-identifier">repTy</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-206"></a><span>                       </span><span class="hs-special">}</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679061253"><span class="hs-identifier hs-var">repTy</span></a><span>
</span><a name="line-207"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-208"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-209"></a><span>    </span><span class="hs-identifier">checkIfNewtype</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>    </span><a name="local-6989586621679061252"><a href="#local-6989586621679061252"><span class="hs-identifier">checkIfNewtype</span></a></a><span>
</span><a name="line-211"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Newtype</span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679061250"><span class="hs-identifier hs-var">dv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">NewtypeInstance</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679061250"><span class="hs-identifier hs-var">dv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-identifier">etaReduce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-216"></a><a name="etaReduce"><a href="Data.Deriving.Via.Internal.html#etaReduce"><span class="hs-identifier">etaReduce</span></a></a><span> </span><a name="local-6989586621679061254"><a href="#local-6989586621679061254"><span class="hs-identifier">num</span></a></a><span> </span><a name="local-6989586621679061255"><a href="#local-6989586621679061255"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-217"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679061256"><a href="#local-6989586621679061256"><span class="hs-identifier">tyHead</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679061257"><a href="#local-6989586621679061257"><span class="hs-identifier">tyArgs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Deriving.Internal.html#unapplyTy"><span class="hs-identifier hs-var">unapplyTy</span></a><span> </span><a href="#local-6989586621679061255"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-218"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679061258"><a href="#local-6989586621679061258"><span class="hs-identifier">tyArgsRemaining</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679061259"><a href="#local-6989586621679061259"><span class="hs-identifier">tyArgsDropped</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">splitAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679061257"><span class="hs-identifier hs-var">tyArgs</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679061254"><span class="hs-identifier hs-var">num</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679061257"><span class="hs-identifier hs-var">tyArgs</span></a><span>
</span><a name="line-219"></a><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Data.Deriving.Internal.html#canEtaReduce"><span class="hs-identifier hs-var">canEtaReduce</span></a><span> </span><a href="#local-6989586621679061258"><span class="hs-identifier hs-var">tyArgsRemaining</span></a><span> </span><a href="#local-6989586621679061259"><span class="hs-identifier hs-var">tyArgsDropped</span></a><span>
</span><a name="line-220"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Deriving.Internal.html#applyTy"><span class="hs-identifier hs-var">applyTy</span></a><span> </span><a href="#local-6989586621679061256"><span class="hs-identifier hs-var">tyHead</span></a><span> </span><a href="#local-6989586621679061258"><span class="hs-identifier hs-var">tyArgsRemaining</span></a><span>
</span><a name="line-221"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-222"></a><span class="hs-cpp">#endif
</span></pre></body></html>